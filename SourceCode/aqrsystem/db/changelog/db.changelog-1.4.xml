<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    
    <property name="provider" value="0"/>
    <property name="country" value="0"/>
    <property name="userrole" value="0"/>
    
    <changeSet id="1.4" author="kopanalk" runAlways="true">
            
        <preConditions onFail="CONTINUE" onFailMessage="Did not insert initial admin! Preconditions failed: init.admins system property missing or foreign key constraint violation!">
            <customPrecondition className="eu.europa.ec.aqrsystem.liquibase.DBInitialAdminPrecondition">
                <param name="admin" value="${init.admins}"/>
            </customPrecondition>
            <sqlCheck expectedResult="0">
                select count(*) from users where name='${init.admins}'
            </sqlCheck>
            <sqlCheck expectedResult="1">
                select count(*) from relatedparty where uuid='${provider}'
            </sqlCheck>
            <sqlCheck expectedResult="1">
                select count(*) from country where uuid='${country}'
            </sqlCheck>
            <sqlCheck expectedResult="1">
                select count(*) from userrole where uuid='${userrole}'
            </sqlCheck>
        </preConditions>
        <sql stripComments="false">
            INSERT INTO users (uuid, email, name, surname, country, userrole, provider, enable, datecreation, lastmodified) VALUES
            (md5('${init.admins}'), 'admin@mail', '${init.admins}', 'surname', '${country}', '${userrole}', '${provider}', true, now(), now());
        </sql>
    </changeSet>
</databaseChangeLog>
